# 장바구니
장바구니 미션 저장소

#1단계 요구사항 정리

- [x] 회원가입
  - [x] 요청으로 이름, 이메일, 비밀번호를 받는다.
  - [x] 응답으로 이름, 이메일을 반환한다. 201
- [x] 로그인
  - [x] 요청으로 이메일, 비밀번호를 받는다.
  - [x] 응답으로 이름, 이메일, 토큰을 반환한다. 200
- [x] 회원 정보 조회
  - [x] 요청으로 토큰을 받는다.
  - [x] 응답으로 이름, 이메일을 반환한다. 200
- [x] 회원 정보 수정 (비밀번호 수정)
  - [x] 요청으로 기존 비밀번호와 바꿀 비밀번호, 토큰을 받는다.
  - [x] 응답으로 이름을 반환하다. 200
- [x] 회원 탈퇴
  - [x] 요청으로 비밀번호와 토큰을 받는다.
  - [x] 204

[API 문서](https://www.notion.so/brorae/1-API-c10e17f6fdc940bbb2379ec7e07b1cb4)
## ✏️ Code Review Process
[텍스트와 이미지로 살펴보는 온라인 코드 리뷰 과정](https://github.com/next-step/nextstep-docs/tree/master/codereview)

## 1단게 수정 사항 & 피드백 정리

- [x] Acceptance test를 하면서 실제 사용자가 생각하는 흐름을 정리해보자
  - 위의 두가지 경우처럼 나눌 수도 있고 더 다양하게 나누는 방법이 있을텐데요.
    알린이 생각하는 시나리오를 한번 생각해보고 그것에 맞게 테스트를 작성해 보면 좋을 것 같아요!
    시나리오로 모든 경우를 테스트할 수 없기 때문에 controller로 통합테스트를 진행하는 것이지 않을까요?
  - 이전까지 인수 테스트에 대한 감이 잘 안와서 모든 E2E 테스트를 인수테스트에서 한 것 같습니다.
  - 피드백에 대해 생각해보다 보니 인수테스트에서는 사용자 입장에서의 시나리오를 작성하여 테스트하고 컨트롤러 테스트에서는 기능 테스트와 예외에 대한 테스트를 하도록 분리할 수 있을 것 같았습니다.
  - 인수 테스트를 할 때 제가 생각하는 시나리오로 인수테스트를 할 수 있도록 수정해보고 주석으로 시나리오를 써봤습니다.
  - 예외 테스트 등은 컨트롤러 테스트로 옮겼습니다.
  - 컨트롤러 테스트에서는 DirtiesContext를 하지 않으면서 속도가 매우 빨라졌습니다.
- [x] interceptor가 ui 패키지에 포함되어 있다. ui보다 config에 있는게 맞지 않을까? ui에 포함하게된 기준이 무엇이었을까?
  - 제 프로젝트에서는 ui 패키지에 Advice, Resolver, Interceptor가 모두 있습니다.
  - 저는 auth.config에는 리졸버와 인터셉터를 등록하고 설정하는 XXXConfig만을 넣어야 한다고 생각했고 사용자의 요청, 응답과 관련된 것들을 ui패키지에 포함시켰습니다.
  - Controller(사용자 요청, 응답 처리), Advice(Controller에서 발생한 문제 핸들링), Resolver(특정 값을 만들어서 Controller에게 전달해줌), Interceptor(Controller가 실행되기 전 요청을 가로채서 특정 로직을 처리함)
- [x] webpage를 보며 me라는 표현을 본적이 없지 않나요?
  - 팀에서 `/{username}`으로 내 username을 요청하는 것이 아닌 `/me`라는 URL을 사용한 이유는 나만의 정보를 조회, 수정, 탈퇴하게 하기 위해서 입니다.
  - `/{username}`처럼 url요청을 받으면 나의 유효한 토큰으로 다른 username의 정보를 조회, 수정, 탈퇴하지 못하게 하려면 토큰의 정보와 `/{username}`의 정보를 비교하는 추가적인 작업이 필요합니다.
  - 이런 가능성을 처음부터 없애기 위해 `/me`처럼 url을 구성했습니다.
  - 그리고 `/me`라는 URL으로 정한 이유는 두 가지입니다.
    1. [prolog](https://github.com/woowacourse/prolog)
    2. [네이버 회원 프로필 조회 API](https://developers.naver.com/docs/login/profile/profile.md)
  - jwt Bearer 토큰을 사용하는 API를 찾아보면서 위 두개를 찾았습니다.
  - prolog는 아직 적용되지는 않았지만 현재 수정되고 있는 코드에서는 내 정보를 조회하거나 할 때 `/me`를 사용하고 있고 네이버 회원 프로필 조회 API에서도 `/me`를 사용하고 있었습니다. 
  - 하지만 myInfo라는 표현이 조금 더 명확해보여서 팀원들과 이야기를 해보겠습니다.
- [x] exception과 runtimeException을 같이 잡은 이유가 있을까요??
  - 둘의 차이점을 크게 생각하지 않고 내가 예상할 수 있는 예외를 제외한 모든 예외를 잡아야겠다는 생각으로 Exception을 핸들링하고 있던 것 같습니다.
  - 프로그램이 실행되면서 발생하는 예외만 잡는다면 runtimeException만 잡아도 될 것 같습니다.
- [x] 로그인 시 `isValidPasswordByEmail()`에 대한 테스트가 없는 것 같다.
- [x] (JwtTokenProvider.getPayload) 한줄에 여러개를 모두 표현하기보다 한줄에 한개씩 표현하는게 더 명확한거 같아요!
- [x] service에서 dto로 변환하여 넘겨주는 것이 역할에 맞을까요??
  - service에서 도메인을 넘겨주고 컨트롤러에서 변환하는 방법과 dto를 넘겨주는 것으로 크루들과 토론한 적이 있습니다. 
  - 도메인 반환 파
    1. 외부의 상황에 따라 컨트롤러가 다를 수 있는데(콘솔/웹 등) 각 컨트롤러에 맞는 DTO를 반환하는 서비스나 메서드를 만들것인가? 도메인 반환이 재사용성이 좋다.
    2. 도메인을 넘기면 앞단에서 수정이 발생해도 서비스의 수정이 생기지 않을 수 있다.
  - DTO 반환 파
    1. 단 하나의 도메인을 반환하는 간단한 경우라면 하나의 도메인 반환으로 해결이 되겠지만 여러 도메인을 반환해야하는 등 로직이 복잡해진다면 모든 도메인을 반환할 것인가?
    2. 도메인의 수정이 생기면 컨트롤러까지 영향을 받는것이 아닐까?
    3. 컨트롤러에서 도메인 로직이 실행되거나 수정될 수 있는 위험을 감수할 필요가 있나?
  - 해당 토론에서는 이런 이야기들이 나왔던 것 같습니다. 저는 DTO 반환파의 1번째, 2번째 이유로 서비스에서 DTO를 반환하는 편입니다.
  - 코드를 다시 보니 서비스에서 로직으로 dto 생성까지 하고 있는데 이부분은 조금 수정할 수 있을 것이라고 생각하여 service가 아닌 dto에서 정적 팩터리 메서드를 이용하도록 수정했습니다.
- [x] Request Dto 의 기본 생성자가 private여도 될 것 같다.

## 2단게 수정 사항 & 피드백 정리

- [ ] 로그인을 하지 않은 상태에서도 장바구니에 물품을 넣을 수 있어야 하지 않을까요?
- [ ] interceptor 설정이 auth package에 있는데 해당 url의 controller 들은 shoppingcart에 있는데 auth에서 설정하는 것이 맞을까요?
- [ ] (AuthorizationExtractor) extract 메서드를 분리하면 좋을 것 같아요ㅎㅎ
- [ ] resolver에서 값을 넣어주기만 하고 있는데요. 검증을 하지 않아도 될까요? 
  - interceptor가 적용된 url에서 모두 @AuthenticationPrincipal가 활용되고 있는데 interceptor에서 검증을 할 필요가 있을까요? 
  - interceptor와 resolver의 역할을 분리했다면 맞을 것 같은데 interceptor와 resolver의 역할을 어떻게 정의했을까요?
- [ ] 전역 변수와 멤버변수 사이에 빈줄을 추가해주는게 더 명확한 거 같아요!
- [ ] ValidtaionException을 만들고 메세지를 전달받아 생성할 수 있게 하는 방식으로 검증 exception 들을 줄일 수도 있을 거 같습니다~
- [ ] productService가 있는데 productDao를 사용한 이유가 있을까요?
- [ ] CarResponse에 정적 팩토리 메서드를 만들어서 활용할 수도 있지 않을까요?
- [ ] 순회를 하면서 조회를 하는데 한번에 조회하는 방법도 있지 않을까요?
- [ ] 서버에서 에러가 발생했습니다 와 같이 표현해주는게 더 파악하기 쉽지 않을까 하는 개인적인 의견입니다~
- [ ] 주문상세를 여러개 가진 주문 한건을 의미하는 것 같은데 Orders가 맞을까요?
- [ ] 도메인과 service에 대한 테스트가 없는 것들이 있는것 같아요!
- [ ] Impl을 붙이는 방식은 이제 사용을 권장하지 않는 것 같아서요. 
  - CartItemRepository를 interface로 하고 CartItemDao가 implments하는 방식으로 해도되지 않을까 싶습니다
